<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Würth Talent Connect — Talent Shaping Dashboard (Prototype)</title>
<meta name="description" content="Talent shaping dashboard with profiles, hackathon plans, progress, uploads and recommendations." />
<link rel="stylesheet" href="styles.css">

</head>
<body>
  <div class="app" aria-live="polite">

    <!-- SIDEBAR -->
    <aside class="sidebar card" aria-label="Main navigation">
      <div class="brand">
        <div class="logo" aria-hidden="true">W</div>
        <div>
          <h1>Würth Talent Connect</h1>
          <p class="muted">Co-innovation hiring</p>
        </div>
      </div>

      <nav class="nav" role="navigation" aria-label="Primary">
        <button class="active" data-view="dashboard">Dashboard</button>
        <button data-view="challenges">Challenges</button>
        <button data-view="profiles">Profiles</button>
        <button data-view="uploads">Resources</button>
        <button data-view="jobs">Job Matches</button>
      </nav>

      <div class="filters card" style="margin-top:14px">
        <label class="muted">Role</label>
        <select id="filter-role">
          <option value="all">All</option>
          <option value="ux">UX Designer</option>
          <option value="fe">Front-End</option>
        </select>

        <label class="muted" style="margin-top:10px">Level</label>
        <select id="filter-level">
          <option value="all">All</option>
          <option value="entry">Entry</option>
          <option value="mid">Mid</option>
          <option value="senior">Senior</option>
        </select>

        <div style="margin-top:12px">
          <button class="btn small" id="new-profile-btn">+ New Profile</button>
        </div>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="main" id="main" role="main">
      <div class="topbar">
        <!-- Hamburger (mobile) -->
        <button id="menu-toggle" class="hamburger" aria-label="Toggle menu" aria-expanded="false" aria-controls="sidebar">
          <span class="hamburger-box"><span class="hamburger-inner"></span></span>
        </button>

        <div class="search card" role="search" aria-label="Search challenges or profiles">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path stroke="rgba(255,255,255,0.45)" stroke-linecap="round" stroke-width="1.5" d="M21 21l-4.35-4.35"/><circle cx="11" cy="11" r="6" stroke="rgba(255,255,255,0.45)" stroke-width="1.5"/></svg>
          <input id="global-search" placeholder="Search profiles, challenges or resources..." />
          <button class="btn ghost small" id="quick-filter">Filters</button>
        </div>

        <div class="avatar">
          <div style="text-align:right">
            <div style="font-weight:700">Design Ops</div>
            <div class="muted" style="font-size:13px">Würth</div>
          </div>
          <div class="user" title="Account">WD</div>
        </div>
      </div>

      <!-- Profiles & Hackathons row -->
      <section class="card" aria-labelledby="profiles-heading">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h2 id="profiles-heading" style="margin:0 0 6px 0">Candidate Profiles</h2>
            <div class="muted small">Tap a profile to see details and personalized recommendations</div>
          </div>
          <div>
            <button class="btn small" id="export-data">Export Data</button>
          </div>
        </div>

        <div style="margin-top:12px" class="profiles" id="profiles-container">
          <!-- profiles injected here -->
        </div>
      </section>

      <!-- Hackathon Plans & Progress Tracking -->
      <section style="display:grid;grid-template-columns:1fr 360px;gap:16px">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <h3 style="margin:0">Hackathon Plans</h3>
              <div class="muted small">Active and upcoming co-innovation challenges</div>
            </div>
            <div>
              <button class="btn small" id="new-hack-btn">+ New Hack</button>
            </div>
          </div>

          <div class="hack-list" id="hack-list" style="margin-top:12px">
            <!-- hack items -->
          </div>
        </div>

        <aside class="card">
          <h3 style="margin:0">Progress Tracking</h3>
          <div class="muted small">Track participant progress & skill coverage</div>

          <div style="margin-top:12px" class="progress-grid" id="progress-grid">
            <!-- progress cards -->
          </div>

        </aside>
      </section>

      <!-- Workspace / Submissions / Activity -->
      <section class="card" aria-label="Workspace and activity">
        <div style="display:flex;justify-content:space-between;gap:12px;align-items:center">
          <div>
            <h3 style="margin:0">Workspace & Submissions</h3>
            <div class="muted small">In-progress submissions are saved automatically</div>
          </div>
          <div style="display:flex;gap:8px">
            <button class="btn ghost small" id="join-quick">Quick Join</button>
            <button class="btn small" id="view-submissions">View All</button>
          </div>
        </div>

        <div style="margin-top:12px;display:flex;gap:12px;flex-wrap:wrap">
          <div style="flex:1;min-width:220px">
            <label class="muted">Selected Profile</label>
            <div id="selected-profile-card" class="card" style="margin-top:8px;padding:10px"></div>
          </div>

          <div style="width:420px;min-width:260px">
            <label class="muted">Current Submission</label>
            <div id="current-submission" class="card" style="margin-top:8px;padding:12px">
              <input id="submission-title" placeholder="Project title or challenge name" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--text)" />
              <textarea id="submission-notes" placeholder="Design rationale, links to Figma or GitHub, notes..." style="width:100%;margin-top:8px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);min-height:80px;background:transparent;color:var(--text)"></textarea>
              <div style="display:flex;gap:8px;margin-top:8px">
                <button class="btn small" id="save-submission">Save Draft</button>
                <button class="btn small" id="submit-final">Submit</button>
              </div>
              <div class="muted small" style="margin-top:8px">Submissions save locally for demo purposes.</div>
            </div>
          </div>
        </div>
      </section>

    </main>

    <!-- RIGHT COLUMN -->
    <aside class="rightcol card" aria-label="Resources and recommendations">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 style="margin:0">Resources</h3>
        <div class="muted small">Upload design artifacts</div>
      </div>

      <div style="margin-top:12px" class="upload-area" id="upload-area" tabindex="0" aria-label="Upload design resources">
        <div style="font-weight:700">Drag & drop files here</div>
        <div class="muted small" style="margin-top:6px">or <label for="file-input" style="color:var(--accent);cursor:pointer">browse</label></div>
        <input id="file-input" type="file" style="display:none" multiple />
        <div class="file-list" id="file-list" aria-live="polite"></div>
      </div>

      <div style="margin-top:16px">
        <h4 style="margin:0">Personalized Recommendations</h4>
        <div class="muted small">Suggestions based on selected profile & activity</div>
        <div class="rec-list" id="recommendations" style="margin-top:10px">
          <!-- rec cards -->
        </div>
      </div>

      <div style="margin-top:12px" class="meta-row">
        <div class="muted small">Data saved locally (demo)</div>
        <div class="muted small">v0.1</div>
      </div>
    </aside>

  </div>

  <!-- backdrop for mobile sidebar -->
  <div id="backdrop" class="backdrop" aria-hidden="true"></div>

<script>
/* ============================
   Prototype data & utilities
   ============================ */

const sampleProfiles = [
  { id: 'p1', name: 'Sofia Müller', role: 'UX Designer', level: 'entry', skills: ['Figma','User Research'], score: 42, bio: 'Recent Interaction Design grad eager to work on B2B products.' },
  { id: 'p2', name: 'Marco Rossi', role: 'UX Designer', level: 'mid', skills: ['Prototyping','UX Strategy','Figma'], score: 68, bio: '3+ years shipping B2B workflows.' },
  { id: 'p3', name: 'Priya Patel', role: 'UX Designer', level: 'senior', skills: ['Design Systems','Research','Leadership'], score: 88, bio: 'Design lead focused on cross-functional outcomes.' },
  { id: 'p4', name: 'Daniel Weber', role: 'Front-End', level: 'entry', skills: ['HTML','CSS','React'], score: 35, bio: 'Bootcamp grad focusing on component-driven UI.' },
  { id: 'p5', name: 'Julia Santos', role: 'Front-End', level: 'mid', skills: ['React','API Integration','Testing'], score: 72, bio: 'Full-stack frontend with an eye for performant interfaces.' },
  { id: 'p6', name: 'Anton Schmidt', role: 'Front-End', level: 'senior', skills: ['Architecture','Performance','Team Leadership'], score: 92, bio: 'Lead dev architecting scalable FE systems.' },
];

const sampleHacks = [
  { id:'h1', title:'Würth Order Flow Revamp', tags:['Design Challenge','Hybrid'], open:true, participants:12, due:'2025-12-15' },
  { id:'h2', title:'Component Library: Accessibility Sprint', tags:['FE Challenge'], open:true, participants:8, due:'2025-12-28' },
  { id:'h3', title:'B2B Onboarding Experience', tags:['Design Challenge'], open:false, participants:20, due:'2025-11-01' },
];

const STORAGE_KEYS = {
  PROFILES: 'wtc_profiles_v1',
  HACKS: 'wtc_hacks_v1',
  FILES: 'wtc_files_v1',
  SUBMISSIONS: 'wtc_subs_v1'
};

function loadOrInit(key, defaultVal){
  const raw = localStorage.getItem(key);
  if(raw) {
    try { return JSON.parse(raw); } catch(e){ console.warn('parse err', e); return defaultVal; }
  }
  localStorage.setItem(key, JSON.stringify(defaultVal));
  return defaultVal;
}

/* -----------------------
   App state
   ----------------------- */
let state = {
  profiles: loadOrInit(STORAGE_KEYS.PROFILES, sampleProfiles),
  hacks: loadOrInit(STORAGE_KEYS.HACKS, sampleHacks),
  files: loadOrInit(STORAGE_KEYS.FILES, []),
  subs: loadOrInit(STORAGE_KEYS.SUBMISSIONS, []),
  selectedProfileId: null,
  view: 'dashboard'
};

/* -----------------------
   Persistence helpers
   ----------------------- */
function persist(key, val){
  localStorage.setItem(key, JSON.stringify(val));
}

/* ============================
   Rendering functions
   ============================ */

const profilesContainer = document.getElementById('profiles-container');
const hackListEl = document.getElementById('hack-list');
const progressGrid = document.getElementById('progress-grid');
const fileListEl = document.getElementById('file-list');
const recList = document.getElementById('recommendations');
const selectedProfileCard = document.getElementById('selected-profile-card');

function formatDate(iso){
  try{ return new Date(iso).toLocaleDateString(); } catch(e){ return iso; }
}

/* Profiles list */
function renderProfiles(){
  const roleFilter = document.getElementById('filter-role').value;
  const levelFilter = document.getElementById('filter-level').value;
  profilesContainer.innerHTML = '';
  const filtered = state.profiles.filter(p=>{
    if(roleFilter !== 'all'){
      if(roleFilter==='ux' && !p.role.toLowerCase().includes('ux')) return false;
      if(roleFilter==='fe' && !p.role.toLowerCase().includes('front')) return false;
    }
    if(levelFilter !== 'all' && p.level !== levelFilter) return false;
    return true;
  });
  filtered.forEach(p=>{
    const el = document.createElement('div');
    el.className = 'profile';
    el.tabIndex = 0;
    el.innerHTML = `
      <div style="width:48px;height:48px;border-radius:8px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700;color:white">${p.name.split(' ').map(s=>s[0]).slice(0,2).join('')}</div>
      <div class="meta">
        <div class="name">${p.name}</div>
        <div class="role muted">${p.role} • ${p.level}</div>
        <div class="small muted" style="margin-top:6px">${p.bio}</div>
      </div>
      <div style="margin-left:auto;text-align:right">
        <div class="pill">${p.skills.join(', ')}</div>
        <div style="margin-top:8px;font-weight:700">${p.score}%</div>
      </div>
    `;
    el.addEventListener('click', ()=>selectProfile(p.id));
    profilesContainer.appendChild(el);
  });
  if(filtered.length===0){
    profilesContainer.innerHTML = '<div class="muted small">No profiles match filters</div>';
  }
}

/* Hackathon plans */
function renderHacks(){
  hackListEl.innerHTML = '';
  state.hacks.forEach(h=>{
    const el = document.createElement('div');
    el.className = 'hack-item';
    el.innerHTML = `
      <div class="left">
        <div style="width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,#153a4a,#0e2630);display:flex;align-items:center;justify-content:center;font-weight:700">${h.title.split(' ').slice(0,1)}</div>
        <div style="margin-left:10px">
          <div style="font-weight:700">${h.title}</div>
          <div class="muted small">${h.tags.join(' • ')}</div>
        </div>
      </div>
      <div style="text-align:right">
        <div class="muted small">Due ${formatDate(h.due)}</div>
        <div style="margin-top:6px;font-weight:700">${h.participants} participants</div>
        <div style="margin-top:8px"><button class="btn small" data-join="${h.id}">${h.open ? 'Join' : 'View'}</button></div>
      </div>
    `;
    hackListEl.appendChild(el);
  });
}

/* Progress tracking — show aggregated metrics and per-skill coverage */
function renderProgress(){
  // Simple aggregation across profiles
  const avgScore = Math.round(state.profiles.reduce((s,p)=>s+p.score,0)/Math.max(1,state.profiles.length));
  const skillCounts = {};
  state.profiles.forEach(p=>{
    p.skills.forEach(s=>{
      skillCounts[s] = (skillCounts[s]||0)+1;
    });
  });
  // Fill grid
  progressGrid.innerHTML = '';
  const aggCard = document.createElement('div');
  aggCard.className = 'card progress-card';
  aggCard.innerHTML = `
    <div style="display:flex;align-items:center;justify-content:space-between">
      <div>
        <div class="muted small">Average candidate score</div>
        <div style="font-weight:800;font-size:18px;margin-top:6px">${avgScore}%</div>
      </div>
      <div style="width:86px;height:86px;border-radius:999px;background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent);display:flex;align-items:center;justify-content:center">
        <div style="width:68px;height:68px;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:800">${avgScore}%</div>
      </div>
    </div>
    <div class="muted small" style="margin-top:8px">Use these scores to prioritize mentoring and fast-track candidates.</div>
  `;
  progressGrid.appendChild(aggCard);

  const skillsCard = document.createElement('div');
  skillsCard.className = 'card progress-card';
  skillsCard.innerHTML = `<div style="font-weight:700">Skill Coverage</div>`;
  Object.entries(skillCounts).sort((a,b)=>b[1]-a[1]).slice(0,6).forEach(([skill,count])=>{
    const row = document.createElement('div');
    row.className = 'progress-row';
    const pct = Math.min(100,Math.round((count/state.profiles.length)*100));
    row.innerHTML = `<div style="font-weight:700">${skill}</div>
      <div style="display:flex;align-items:center;width:55%">
        <div class="progress-bar"><i style="width:${pct}%"></i></div>
        <div style="width:36px;text-align:right;margin-left:8px">${pct}%</div>
      </div>`;
    skillsCard.appendChild(row);
  });
  progressGrid.appendChild(skillsCard);
}

/* Files upload list */
function renderFiles(){
  fileListEl.innerHTML = '';
  if(state.files.length === 0){
    fileListEl.innerHTML = '<div class="muted small">No uploaded files yet</div>';
    return;
  }
  state.files.slice().reverse().forEach(f=>{
    const el = document.createElement('div');
    el.className = 'file-item';
    el.innerHTML = `
      <div style="display:flex;gap:10px;align-items:center">
        <div style="width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,#1f2b36,#15232a);display:flex;align-items:center;justify-content:center">${f.name.slice(-3).toUpperCase()}</div>
        <div>
          <div style="font-weight:700">${f.name}</div>
          <div class="muted small">${f.type || '—'} • ${new Date(f.uploaded).toLocaleString()}</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn ghost small" data-download="${f.id}">Download</button>
        <button class="btn small" data-remove="${f.id}">Remove</button>
      </div>
    `;
    fileListEl.appendChild(el);
  });
}

/* Recommendations generator (simple rule-based) */
function computeRecommendations(profile){
  // If no select, show general recs
  if(!profile){
    return [
      { id:'r1', title:'Explore Würth Design Guidelines', why:'Understand B2B patterns used inside Würth', action:'Open resources hub' },
      { id:'r2', title:'Join "Order Flow Revamp"', why:'Great way to show end-to-end thinking', action:'View hackathon' },
      { id:'r3', title:'Upload portfolio or GitHub', why:'Increases chance to fast-track', action:'Upload now' }
    ];
  }
  const recs = [];
  // Tips based on role/level/skills
  if(profile.level === 'entry'){
    recs.push({ id:'re-entry-1', title:'Complete a guided challenge', why:'You will get mentor feedback and a sample case for your portfolio', action:'Start guided challenge' });
    recs.push({ id:'re-entry-2', title:'Add case studies to Portfolio', why:'Short case studies (1-2 pages) help recruiters', action:'Edit portfolio' });
  } else if(profile.level === 'mid'){
    recs.push({ id:'re-mid-1', title:'Join cross-functional sprint', why:'Demonstrate collaboration with FE & PM', action:'Apply to sprint' });
    recs.push({ id:'re-mid-2', title:'Request code review from Würth engineers', why:'Show production readiness', action:'Request review' });
  } else {
    recs.push({ id:'re-senior-1', title:'Lead an architecture review', why:'Show strategic thinking and tradeoffs', action:'Offer to mentor' });
    recs.push({ id:'re-senior-2', title:'Host a Design Critique', why:'Influence hiring decisions with senior presence', action:'Propose session' });
  }
  // skill-specific
  if(profile.skills.includes('Accessibility') || profile.skills.includes('Figma')){
    recs.push({ id:'re-skill-1', title:'Accessibility sprint challenge', why:'Show depth in inclusive design', action:'Join challenge' });
  }
  // personalized: show top matching open hackathon
  const matchHack = state.hacks.find(h=>h.open && (h.tags.join(' ').toLowerCase().includes(profile.role.toLowerCase().split(' ')[0]) || h.tags.join(' ').toLowerCase().includes('hybrid')));
  if(matchHack){
    recs.unshift({ id:'match1', title:`Recommended: ${matchHack.title}`, why:`Matches your role & is open; ${matchHack.participants} participants`, action:'View hackathon' });
  }
  return recs;
}

/* Render recommendations */
function renderRecommendations(){
  const profile = state.profiles.find(p=>p.id === state.selectedProfileId) || null;
  const recs = computeRecommendations(profile);
  recList.innerHTML = '';
  recs.forEach(r=>{
    const el = document.createElement('div');
    el.className = 'rec-card';
    el.innerHTML = `<h4>${r.title}</h4><div class="small muted">${r.why}</div><div style="margin-top:8px"><button class="btn small" data-rec="${r.id}">${r.action}</button></div>`;
    recList.appendChild(el);
  });
}

/* Selected profile details */
function renderSelectedProfile(){
  if(!state.selectedProfileId){
    selectedProfileCard.innerHTML = `<div class="muted small">No profile selected. Click a profile to see details and personalized recommendations.</div>`;
    renderRecommendations();
    return;
  }
  const p = state.profiles.find(x=>x.id===state.selectedProfileId);
  if(!p) return;
  selectedProfileCard.innerHTML = `
    <div style="display:flex;gap:12px;align-items:center">
      <div style="width:54px;height:54px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700">${p.name.split(' ').map(s=>s[0]).slice(0,2).join('')}</div>
      <div>
        <div style="font-weight:800">${p.name}</div>
        <div class="muted">${p.role} • ${p.level}</div>
        <div style="margin-top:8px" class="small">${p.bio}</div>
      </div>
    </div>
    <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
      <div class="pill">${p.skills.join(', ')}</div>
      <div class="pill">Score: ${p.score}%</div>
    </div>
    <div style="margin-top:10px" class="muted small">Use the recommendations panel to assign focused challenges or invite to sprints.</div>
  `;
  renderRecommendations();
}

/* Generic refresh */
function renderAll(){
  renderProfiles();
  renderHacks();
  renderProgress();
  renderFiles();
  renderSelectedProfile();
}

/* ============================
   Event handlers & interactions
   ============================ */

function selectProfile(id){
  state.selectedProfileId = id;
  renderSelectedProfile();
  // auto-scroll to recommendations on small screens
  if(window.innerWidth < 800){
    document.getElementById('recommendations').scrollIntoView({behavior:'smooth'});
  }
}

/* Create new profile (quick modalless input for demo) */
document.getElementById('new-profile-btn').addEventListener('click', ()=>{
  const name = prompt('New profile name (e.g. Jane Doe)');
  if(!name) return;
  const role = prompt('Role (UX Designer / Front-End)') || 'UX Designer';
  const level = prompt('Level (entry/mid/senior)') || 'entry';
  const skills = prompt('Comma separated skills (e.g. Figma,Research)') || '';
  const newP = {
    id: 'p' + Date.now(),
    name,
    role,
    level,
    skills: skills.split(',').map(s=>s.trim()).filter(Boolean),
    score: Math.max(20, Math.round(Math.random()*80)),
    bio: 'New candidate added via dashboard'
  };
  state.profiles.push(newP);
  persist(STORAGE_KEYS.PROFILES, state.profiles);
  renderAll();
});

/* New hack */
document.getElementById('new-hack-btn').addEventListener('click', ()=>{
  const title = prompt('Hackathon title');
  if(!title) return;
  const tags = prompt('Tags comma separated (e.g. Design Challenge,Hybrid)') || '';
  const due = prompt('Due date (YYYY-MM-DD)') || new Date(Date.now()+7*24*3600*1000).toISOString().slice(0,10);
  const newH = {
    id: 'h' + Date.now(),
    title,
    tags: tags.split(',').map(t=>t.trim()).filter(Boolean),
    open: true,
    participants: 0,
    due
  };
  state.hacks.push(newH);
  persist(STORAGE_KEYS.HACKS, state.hacks);
  renderHacks();
});

/* Join hack click handling */
hackListEl.addEventListener('click', (e)=>{
  const id = e.target.getAttribute('data-join');
  if(!id) return;
  const hack = state.hacks.find(h=>h.id===id);
  if(!hack) return;
  if(state.selectedProfileId){
    hack.participants += 1;
    // For demo, add a lightweight submission record
    const sub = { id: 's'+Date.now(), profileId: state.selectedProfileId, hackId: hack.id, title: hack.title, status: 'draft', created: new Date().toISOString() };
    state.subs.push(sub);
    persist(STORAGE_KEYS.SUBMISSIONS, state.subs);
    persist(STORAGE_KEYS.HACKS, state.hacks);
    alert('You joined as ' + (state.profiles.find(p=>p.id===state.selectedProfileId).name) + '. Draft submission created.');
    renderHacks();
    renderAll();
  } else {
    alert('Select a profile first to join a hackathon.');
  }
});

/* Save/Submit current submission (local demo) */
document.getElementById('save-submission').addEventListener('click', ()=>{
  const title = document.getElementById('submission-title').value.trim();
  const notes = document.getElementById('submission-notes').value.trim();
  if(!title){ alert('Give the submission a title.'); return; }
  if(!state.selectedProfileId){ alert('Select a profile first.'); return; }
  const draft = { id: 's'+Date.now(), profileId: state.selectedProfileId, title, notes, status:'draft', created:new Date().toISOString() };
  state.subs.push(draft);
  persist(STORAGE_KEYS.SUBMISSIONS, state.subs);
  alert('Draft saved locally.');
});

document.getElementById('submit-final').addEventListener('click', ()=>{
  const title = document.getElementById('submission-title').value.trim();
  const notes = document.getElementById('submission-notes').value.trim();
  if(!title){ alert('Give the submission a title.'); return; }
  if(!state.selectedProfileId){ alert('Select a profile first.'); return; }
  const final = { id: 's'+Date.now(), profileId: state.selectedProfileId, title, notes, status:'submitted', created:new Date().toISOString() };
  state.subs.push(final);
  // Increase profile score slightly for demo
  const p = state.profiles.find(x=>x.id===state.selectedProfileId);
  if(p){ p.score = Math.min(100, p.score + 6); persist(STORAGE_KEYS.PROFILES, state.profiles); }
  persist(STORAGE_KEYS.SUBMISSIONS, state.subs);
  alert('Submission sent. Recruiters will review it (demo).');
  renderAll();
});

/* File uploads (Drag & drop + input) */
const uploadArea = document.getElementById('upload-area');
const fileInput = document.getElementById('file-input');

uploadArea.addEventListener('click', ()=>fileInput.click());
fileInput.addEventListener('change', (ev)=>{
  handleFiles(Array.from(ev.target.files));
});

uploadArea.addEventListener('dragover', (ev)=>{
  ev.preventDefault();
  uploadArea.classList.add('dragover');
});
uploadArea.addEventListener('dragleave', ()=>uploadArea.classList.remove('dragover'));
uploadArea.addEventListener('drop', (ev)=>{
  ev.preventDefault();
  uploadArea.classList.remove('dragover');
  const files = Array.from(ev.dataTransfer.files || []);
  handleFiles(files);
});

function handleFiles(files){
  if(files.length === 0) return;
  files.forEach(file=>{
    // For demo we don't store content — store metadata + create downloadable blob
    const reader = new FileReader();
    reader.onload = function(e){
      const id = 'f' + Date.now() + Math.floor(Math.random()*999);
      // store in-memory URL for download demo
      const metadata = { id, name: file.name, type: file.type, uploaded: new Date().toISOString(), data: e.target.result };
      state.files.push(metadata);
      persist(STORAGE_KEYS.FILES, state.files);
      renderFiles();
    };
    reader.readAsDataURL(file);
  });
}

/* File list handling: download & remove */
fileListEl.addEventListener('click', (e)=>{
  const idDl = e.target.getAttribute('data-download');
  const idRm = e.target.getAttribute('data-remove');
  if(idDl){
    const f = state.files.find(x=>x.id===idDl);
    if(!f) return;
    // create temporary link
    const a = document.createElement('a');
    a.href = f.data;
    a.download = f.name;
    document.body.appendChild(a);
    a.click();
    a.remove();
  } else if(idRm){
    if(!confirm('Remove this file?')) return;
    state.files = state.files.filter(x=>x.id!==idRm);
    persist(STORAGE_KEYS.FILES, state.files);
    renderFiles();
  }
});

/* Quick actions & export */
document.getElementById('export-data').addEventListener('click', ()=>{
  const payload = { profiles: state.profiles, hacks: state.hacks, files: state.files, submissions: state.subs };
  const blob = new Blob([JSON.stringify(payload, null, 2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'wtc_export_' + new Date().toISOString().slice(0,19).replace(/[:T]/g,'-') + '.json';
  document.body.appendChild(a); a.click(); a.remove();
});

/* Basic nav buttons */
document.querySelectorAll('.nav button').forEach(b=>{
  b.addEventListener('click', (e)=>{
    document.querySelectorAll('.nav button').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    // For demo, just change view state and alert
    const view = b.getAttribute('data-view');
    state.view = view;
    // optionally we could switch panels, keep simple
    alert('Switching to: ' + view + ' (demo view switch)');
  });
});

/* Filters & search */
document.getElementById('filter-role').addEventListener('change', renderProfiles);
document.getElementById('filter-level').addEventListener('change', renderProfiles);
document.getElementById('global-search').addEventListener('input', (e)=>{
  const q = e.target.value.toLowerCase().trim();
  if(!q) { renderAll(); return; }
  // naive search: filter profiles/hacks/files (update list areas)
  profilesContainer.innerHTML = '';
  state.profiles.filter(p=> (p.name+ ' ' + p.skills.join(' ') + ' ' + p.bio).toLowerCase().includes(q)).forEach(p=>{
    const el = document.createElement('div');
    el.className = 'profile';
    el.innerHTML = `<div style="width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center">${p.name.split(' ').map(s=>s[0]).slice(0,2).join('')}</div>
      <div class="meta"><div class="name">${p.name}</div><div class="role muted">${p.role}</div></div>`;
    el.addEventListener('click', ()=>selectProfile(p.id));
    profilesContainer.appendChild(el);
  });
});

/* Recommendations actions (buttons) */
recList.addEventListener('click', (e)=>{
  const rid = e.target.getAttribute('data-rec');
  if(!rid) return;
  alert('Recommendation action: ' + rid + ' (demo). In a full app this would open the relevant flow.');
});

/* Initialize UI — default selected profile */
if(state.profiles && state.profiles.length>0){
  state.selectedProfileId = state.profiles[0].id;
}

renderAll();

/* Accessibility: focus styles for keyboard users */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'k' && (e.ctrlKey || e.metaKey)){
    e.preventDefault();
    document.getElementById('global-search').focus();
  }
});
// Toggle sidebar on mobile
(function(){
  const menuToggle = document.getElementById('menu-toggle');
  const backdrop = document.getElementById('backdrop');
  const appEl = document.documentElement; // use documentElement to scope theme and sidebar class

  function setSidebarOpen(open){
    if(open){
      appEl.classList.add('sidebar-open');
      menuToggle.setAttribute('aria-expanded','true');
      backdrop.setAttribute('aria-hidden','false');
    } else {
      appEl.classList.remove('sidebar-open');
      menuToggle.setAttribute('aria-expanded','false');
      backdrop.setAttribute('aria-hidden','true');
    }
  }

  menuToggle.addEventListener('click', (e)=>{
    e.stopPropagation();
    const isOpen = appEl.classList.contains('sidebar-open');
    setSidebarOpen(!isOpen);
  });

  backdrop.addEventListener('click', ()=> setSidebarOpen(false));

  /* Filters & search */

  document.getElementById('filter-role').addEventListener('change', renderProfiles);
document.getElementById('filter-level').addEventListener('change', renderProfiles);

// ADD THIS: Quick filter button - opens sidebar on mobile to show filters
document.getElementById('quick-filter').addEventListener('click', ()=>{
  // On mobile: open sidebar to reveal filters
  if(window.innerWidth <= 900){
    const appEl = document.documentElement;
    if(!appEl.classList.contains('sidebar-open')){
      appEl.classList.add('sidebar-open');
      document.getElementById('menu-toggle').setAttribute('aria-expanded','true');
      document.getElementById('backdrop').setAttribute('aria-hidden','false');
    }
  } else {
    // On desktop: focus the first filter select
    document.getElementById('filter-role').focus();
  }
});

document.getElementById('global-search').addEventListener('input', (e)=>{
  const q = e.target.value.toLowerCase().trim();
  if(!q) { renderAll(); return; }
  // naive search: filter profiles/hacks/files (update list areas)
  profilesContainer.innerHTML = '';
  state.profiles.filter(p=> (p.name+ ' ' + p.skills.join(' ') + ' ' + p.bio).toLowerCase().includes(q)).forEach(p=>{
    const el = document.createElement('div');
    el.className = 'profile';
    el.innerHTML = `<div style="width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center">${p.name.split(' ').map(s=>s[0]).slice(0,2).join('')}</div>
      <div class="meta"><div class="name">${p.name}</div><div class="role muted">${p.role}</div></div>`;
    el.addEventListener('click', ()=>selectProfile(p.id));
    profilesContainer.appendChild(el);
  });
});

  // Close sidebar when selecting a nav item on small screens
  document.querySelectorAll('.nav button').forEach(b=>{
    b.addEventListener('click', ()=>{
      if(window.innerWidth <= 900){
        setSidebarOpen(false);
      }
    });
  });

  // Accessibility: close sidebar on Escape
  document.addEventListener('keydown', (e)=>{
    if(e.key === 'Escape' && appEl.classList.contains('sidebar-open')){
      setSidebarOpen(false);
    }
  });

  // Theme detection: set data-theme on documentElement and respond to changes
  const mq = window.matchMedia('(prefers-color-scheme: light)');
  function applyTheme(light){
    if(light){
      appEl.setAttribute('data-theme','light');
    } else {
      appEl.setAttribute('data-theme','dark');
    }
  }
  applyTheme(mq.matches);
  mq.addEventListener && mq.addEventListener('change', (ev)=> applyTheme(ev.matches));
})();
</script>
</body>
</html>
